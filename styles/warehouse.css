/* ====== Base ====== */
:root{
  --bg:#0f1115;
  --panel:#171a21;
  --panel-2:#1b1f27;
  --text:#e8ecf1;
  --muted:#98a2b3;
  --primary:#4cc9f0;
  --primary-2:#34a4c8;
  --accent:#a78bfa;
  --success:#22c55e;
  --warning:#f59e0b;
  --danger:#ef4444;

  --prod:#22d3ee;  /* cyan */
  --log:#f97316;   /* orange */
  --meta:#a78bfa;  /* purple */

  --badge-common:#3b3f4a;
  --badge-rare:#3a5fb7;
  --badge-epic:#7c3aed;
  --badge-legend:#d97706;

  --radius:12px;
  --shadow:0 6px 24px rgba(0,0,0,.35);
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  background:linear-gradient(180deg,#0e1014, #0c0f14 50%, #0a0d12);
  color:var(--text);
  font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;
}

/* ====== Topbar / Tabs ====== */
.topbar{
  position:sticky; top:0; z-index:50;
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; padding:10px 16px;
  background:rgba(15,17,21,.7); backdrop-filter: blur(8px);
  border-bottom:1px solid #1f232b;
}
.brand{ font-weight:700; letter-spacing:.2px; }
.version{ color:var(--muted); font-size:12px; }

.tabs{ display:flex; gap:8px; }
.tab-button{
  padding:8px 12px; border-radius:999px; border:1px solid #2a2f39;
  background:#12151b; color:var(--text); cursor:pointer;
}
.tab-button:hover{ background:#151922; }
.tab-button.active{
  background:linear-gradient(180deg,#263041,#1b2230);
  border-color:#3a4456;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
}

/* ====== Layout ====== */
main{ padding:18px; max-width:1100px; margin:0 auto; }
.hidden{ display:none !important; }

/* ====== KPI Strip ====== */
.kpis{
  display:grid; gap:10px;
  grid-template-columns: repeat(6, minmax(0,1fr));
  margin-bottom:16px;
}
.kpi{
  background:var(--panel);
  border:1px solid #222735;
  border-radius:var(--radius);
  padding:10px 12px;
  box-shadow:var(--shadow);
}
.kpi-title{ color:var(--muted); font-size:12px; margin-bottom:6px; }
.kpi-value{ font-size:18px; font-weight:700; display:flex; align-items:baseline; gap:6px; }
.kpi-sub{ color:var(--muted); font-size:12px; }
.kpi-value.score{ color:var(--success); }

/* ====== Panels ====== */
.panel{
  background:linear-gradient(180deg, var(--panel), var(--panel-2));
  border:1px solid #252a36;
  border-radius:var(--radius);
  padding:14px;
  box-shadow: var(--shadow);
}
.panel + .panel{ margin-top:12px; }
.panel-title{
  font-weight:700; margin-bottom:10px; letter-spacing:.2px;
}

.grid-2{
  display:grid; gap:12px;
  grid-template-columns: repeat(2, minmax(0,1fr));
}
@media (max-width: 960px){
  .kpis{ grid-template-columns: repeat(2, minmax(0,1fr)); }
  .grid-2{ grid-template-columns: 1fr; }
}

/* ====== Buttons ====== */
button{
  appearance:none; -webkit-appearance:none;
  border:1px solid #2b3241; color:var(--text);
  background:#12151a; cursor:pointer;
  padding:10px 12px; border-radius:10px;
  transition: transform .05s ease, background .15s ease, border-color .15s ease;
}
button:hover{ background:#161b24; }
button:active{ transform: translateY(1px) scale(.997); }
button:disabled{
  opacity:.55; cursor:not-allowed; filter:saturate(.6);
}

.btn-row{ display:flex; gap:10px; flex-wrap:wrap; }
.btn-col{ display:flex; flex-direction:column; gap:10px; }

.affordable{ border-color:#2f6df0; box-shadow:0 0 0 1px rgba(76,201,240,.15) inset; }
.unaffordable{ opacity:.6; }

.mini-info{ display:flex; gap:8px; align-items:center; color:var(--muted); font-size:12px; margin-top:4px; }
.muted{ color:var(--muted); }
.small{ font-size:12px; }

/* ====== Legend (Prestige) ====== */
.legend-row{ display:flex; align-items:center; gap:8px; margin:6px 0; }
.dot{ width:10px; height:10px; border-radius:999px; display:inline-block; }
.dot-prod{ background:var(--prod); }
.dot-log{ background:var(--log); }
.dot-meta{ background:var(--meta); }

/* ====== Prestige Tree ====== */
.tree-wrap{
  display:grid; gap:12px; grid-template-columns: 1fr 320px;
  align-items: stretch; margin-top:12px;
}
.tree-canvas{
  background: radial-gradient(1200px 500px at 50% -10%, #182234 0%, #121722 60%, #10141c 100%);
  border:1px solid #23293a; border-radius:var(--radius); padding:10px;
  overflow:auto; min-height:460px;
}
.tree-canvas svg{ width:100%; height:100%; min-height:540px; }
.side .panel{ position:sticky; top:86px; }

.edge{ stroke:#2e3a54; stroke-width:2; opacity:.8; }
.node circle{
  fill:#1a2232; stroke:#384766; stroke-width:2;
  filter: drop-shadow(0 4px 10px rgba(0,0,0,.35));
}
.node text{ fill:#e6eef7; font-weight:700; text-anchor:middle; dominant-baseline:middle; }
.node .lvl{ fill:#a6b2c7; font-size:12px; text-anchor:start; }
.node.prod circle{ stroke: var(--prod); }
.node.log  circle{ stroke: var(--log);  }
.node.meta circle{ stroke: var(--meta); }
.node.selected circle{ stroke-width:3; }

/* ====== Contracts ====== */
.contracts-grid .panel#contract-active{ position:relative; overflow:hidden; }
.row{ display:flex; align-items:center; gap:8px; }
.space-between{ justify-content:space-between; }

.badge{
  display:inline-flex; align-items:center; justify-content:center;
  padding:2px 8px; border-radius:999px; font-size:12px; font-weight:700;
  border:1px solid rgba(255,255,255,.08);
}
.badge-common{ background:var(--badge-common); }
.badge-rare{ background:rgba(58,95,183,.2); color:#cdd9ff; border-color:#3a5fb7; }
.badge-epic{ background:rgba(124,58,237,.18); color:#e9ddff; border-color:#7c3aed; }
.badge-legendary{ background:rgba(217,119,6,.18); color:#ffe9c7; border-color:#d97706; }

.progress{
  width:100%; height:10px; border-radius:999px;
  background:#1a2230; border:1px solid #2b3346; margin:8px 0 6px;
  overflow:hidden;
}
#contract-progress{
  width:0%; height:100%;
  background: linear-gradient(90deg,#22c55e,#16a34a);
  box-shadow: inset 0 0 6px rgba(0,0,0,.35);
  transition: width .25s ease;
}

/* Confetti burst container (absolute to panel) */
#contract-burst{
  position:absolute; inset:0; pointer-events:none; overflow:hidden;
}
.confetti{
  position:absolute; width:8px; height:12px; border-radius:2px;
  animation: confetti-fall .9s ease-out forwards;
  transform: translate(0,0) rotate(0deg);
  opacity:.95;
}
@keyframes confetti-fall{
  0%   { transform: translate(0,0) rotate(0deg); opacity:1; }
  100% { transform: translate(var(--dx,120px), var(--dy,220px)) rotate(260deg); opacity:0; }
}

/* Tab pulse (when contract completes) */
#tab-contracts.pulse{
  animation: tabPulse 1.2s ease-in-out 2;
}
@keyframes tabPulse{
  0%{ box-shadow:0 0 0 0 rgba(34,197,94,.0); }
  50%{ box-shadow:0 0 0 6px rgba(34,197,94,.25); }
  100%{ box-shadow:0 0 0 0 rgba(34,197,94,.0); }
}

/* ====== Toasts ====== */
#toast-container{
  position:fixed; left:0; top:0; width:100%; height:0; pointer-events:none; z-index:80;
}
.toast{
  position:absolute; transform: translate(-50%, 0);
  background:#0f141d; border:1px solid #263046; color:#eaf2ff;
  padding:6px 10px; border-radius:8px; font-weight:700; font-size:13px;
  box-shadow:0 8px 24px rgba(0,0,0,.45);
  animation: toastUp .9s ease-out forwards;
}
.toast.box{ border-color:#1d8db0; }
.toast.muns{ border-color:#2f7a2f; }
@keyframes toastUp{
  0%{ opacity:0; transform: translate(-50%, 2px) scale(.98); }
  10%{ opacity:1; transform: translate(-50%, -8px) scale(1); }
  100%{ opacity:0; transform: translate(-50%, -36px) scale(.98); }
}

/* ====== Settings (forms & switches) ====== */
.form-row{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; padding:8px 0; border-bottom:1px dashed #23293a;
}
.form-row:last-child{ border-bottom:none; }
.form-label{ font-weight:600; }

.switch{
  position:relative; display:inline-block; width:44px; height:24px;
}
.switch input{ display:none; }
.slider{
  position:absolute; cursor:pointer; inset:0;
  background:#222838; border:1px solid #2e3650; border-radius:999px;
  transition: background .15s ease, border-color .15s ease;
}
.slider:before{
  content:""; position:absolute; height:18px; width:18px; left:3px; top:2px;
  background:#e8ecf1; border-radius:50%; transition: transform .15s ease;
  box-shadow:0 1px 2px rgba(0,0,0,.4);
}
.switch input:checked + .slider{
  background:#234a6b; border-color:#2b6fa0;
}
.switch input:checked + .slider:before{
  transform: translateX(18px);
}

/* ====== Helpers ====== */
a{ color:var(--primary); text-decoration:none; }
a:hover{ text-decoration:underline; }

hr{ border:none; height:1px; background: #23293a; margin:10px 0; }

.kpi .kpi-value strong{ font-weight:800; }

/* Smaller tweaks for narrow screens */
@media (max-width:560px){
  .topbar{ flex-wrap:wrap; gap:8px; }
  .version{ width:100%; text-align:right; }
}